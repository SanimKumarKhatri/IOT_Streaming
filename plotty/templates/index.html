<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js"></script>
</head>
<body>
    <h2>Accelerometer Data</h2>
    <div id="accel_graph"></div>

    <h2>Gyroscope Data</h2>
    <div id="gyro_graph"></div>

    <h2>Temperature Data</h2>
    <div id="temp_graph"></div>

    <script>
        var socket = io();
        var timeData = [];
        var accelXData = [];
        var accelYData = [];
        var accelZData = [];
        var gyroXData = [];
        var gyroYData = [];
        var gyroZData = [];
        var tempData = [];
        
        var maxDataPoints = 50; 

        function createGraph(divId, title, yTitle, traces) {
            var layout = { title: title, xaxis: { title: 'Time' }, yaxis: { title: yTitle } };
            Plotly.newPlot(divId, traces, layout);
        }

        createGraph('accel_graph', 'Accelerometer Data', 'm/s2',
            { x: [], y: [], mode: "lines", name: "X-axis" },
            { x: [], y: [], mode: "lines", name: "Y-axis" },
            { x: [], y: [], mode: "lines", name: "Z-axis" }
        );
        createGraph('gyro_graph', 'Gyroscope Data', 'deg/s',
            { x: [], y: [], mode: "lines", name: "X-axis" },
            { x: [], y: [], mode: "lines", name: "Y-axis" },
            { x: [], y: [], mode: "lines", name: "Z-axis" }
        );
        createGraph('temp_graph', 'Temperature', 'Â°C',
            { x: [], y: [], mode: "lines", name: "Temperature"}
        );

        socket.on('update_data', function(msg) {
            console.log("Received accel data:", msg);
            if (timeData.length > maxDataPoints) {  
                timeData.shift();
                accelXData.shift();
                accelYData.shift();
                accelZData.shift();
                gyroXData.shift();
                gyroYData.shift();
                gyroZData.shift();
                tempData.shift();
            }
    
            timeData.push(msg.time);
            accelXData.push(msg.accel_x);
            accelYData.push(msg.accel_y);
            accelZData.push(msg.accel_z);
            gyroXData.push(msg.gyro_x);
            gyroYData.push(msg.gyro_y);
            gyroZData.push(msg.gyro_z);
            tempData.push(msg.temperature);

            Plotly.react('accel_graph', [
                { x: [...timeData], y: [...accelXData], mode: "lines", name: "X-axis" },
                { x: [...timeData], y: [...accelYData], mode: "lines", name: "Y-axis" },
                { x: [...timeData], y: [...accelZData], mode: "lines", name: "Z-axis" }
            ]);
            Plotly.react('gyro_graph',  [
                { x: [...timeData], y: [...gyroXData], mode: "lines", name: "X-axis" },
                { x: [...timeData], y: [...gyroYData], mode: "lines", name: "Y-axis" },
                { x: [...timeData], y: [...gyroZData], mode: "lines", name: "Z-axis" }
            ]);
            Plotly.react('temp_graph',  [
                { x: [...timeData], y: [...tempData], mode: "lines", name: "Temperature" },
            ]);
        });
    </script>
</body>
</html>
